<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vintage Charge-off Forecasting Demo - Sample Output</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        .output-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }
        .data-table th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        .data-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .data-table tr:hover {
            background-color: #e8f4fd;
        }
        .metric-box {
            display: inline-block;
            background: #e8f5e8;
            border: 1px solid #28a745;
            border-radius: 5px;
            padding: 10px 15px;
            margin: 5px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
        }
        .metric-label {
            font-size: 12px;
            color: #666;
        }
        .chart-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .chart-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .fico-band {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .fico-800 { background: #d4edda; color: #155724; }
        .fico-750 { background: #d1ecf1; color: #0c5460; }
        .fico-700 { background: #fff3cd; color: #856404; }
        .fico-650 { background: #f8d7da; color: #721c24; }
        .fico-600 { background: #f5c6cb; color: #721c24; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .danger { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>Standalone Vintage Charge-off Forecasting Demo</h1>
        <p style="text-align: center; color: #666; font-style: italic;">
            Sample output from optimized Snowflake workflow for large datasets (10M+ rows)
        </p>

        <h2>1. Data Loading and Processing</h2>
        <div class="output-section">
            <h3>Loading vintage metrics (aggregated data)...</h3>
            <p class="success">✓ Loaded 47,520 vintage metric records (vs 10M+ raw records)</p>
            <p class="info">Memory usage: ~8.2 MB</p>
            
            <h3>Loading loan summary...</h3>
            <p class="success">✓ Loaded 125,430 loan summary records</p>
            
            <h3>Data Quality Check:</h3>
            <div class="metric-box">
                <div class="metric-value">47,520</div>
                <div class="metric-label">Total Records</div>
            </div>
            <div class="metric-box">
                <div class="metric-value">0</div>
                <div class="metric-label">Null Values</div>
            </div>
            <div class="metric-box">
                <div class="metric-value">0</div>
                <div class="metric-label">Negative Values</div>
            </div>
            <div class="metric-box">
                <div class="metric-value">0</div>
                <div class="metric-label">Values > 1</div>
            </div>
        </div>

        <h2>2. Vintage Analysis Summary</h2>
        <div class="output-section">
            <h3>Sample Vintage Metrics by FICO Band:</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>FICO Band</th>
                        <th>Count</th>
                        <th>Mean CGCO%</th>
                        <th>Std Dev</th>
                        <th>Min</th>
                        <th>25%</th>
                        <th>50%</th>
                        <th>75%</th>
                        <th>Max</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="fico-band fico-800">800+</span></td>
                        <td>7,920</td>
                        <td>0.015</td>
                        <td>0.008</td>
                        <td>0.002</td>
                        <td>0.009</td>
                        <td>0.014</td>
                        <td>0.020</td>
                        <td>0.035</td>
                    </tr>
                    <tr>
                        <td><span class="fico-band fico-750">750-799</span></td>
                        <td>9,504</td>
                        <td>0.025</td>
                        <td>0.012</td>
                        <td>0.005</td>
                        <td>0.016</td>
                        <td>0.024</td>
                        <td>0.032</td>
                        <td>0.055</td>
                    </tr>
                    <tr>
                        <td><span class="fico-band fico-700">700-749</span></td>
                        <td>11,880</td>
                        <td>0.040</td>
                        <td>0.018</td>
                        <td>0.008</td>
                        <td>0.026</td>
                        <td>0.038</td>
                        <td>0.052</td>
                        <td>0.085</td>
                    </tr>
                    <tr>
                        <td><span class="fico-band fico-650">650-699</span></td>
                        <td>9,504</td>
                        <td>0.065</td>
                        <td>0.025</td>
                        <td>0.015</td>
                        <td>0.045</td>
                        <td>0.062</td>
                        <td>0.082</td>
                        <td>0.125</td>
                    </tr>
                    <tr>
                        <td><span class="fico-band fico-600">600-649</span></td>
                        <td>7,920</td>
                        <td>0.095</td>
                        <td>0.035</td>
                        <td>0.025</td>
                        <td>0.068</td>
                        <td>0.092</td>
                        <td>0.118</td>
                        <td>0.175</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>3. Model Comparison Results</h2>
        <div class="output-section">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>FICO Band</th>
                        <th>Model</th>
                        <th>RMSE</th>
                        <th>R²</th>
                        <th>Explainability</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="4"><span class="fico-band fico-800">800+</span></td>
                        <td>Weibull</td>
                        <td>0.0023</td>
                        <td>0.987</td>
                        <td>High</td>
                    </tr>
                    <tr>
                        <td>Lognormal</td>
                        <td>0.0028</td>
                        <td>0.981</td>
                        <td>High</td>
                    </tr>
                    <tr>
                        <td>Gompertz</td>
                        <td>0.0031</td>
                        <td>0.976</td>
                        <td>High</td>
                    </tr>
                    <tr>
                        <td>Ensemble</td>
                        <td>0.0021</td>
                        <td>0.991</td>
                        <td>Medium</td>
                    </tr>
                    <tr>
                        <td rowspan="4"><span class="fico-band fico-750">750-799</span></td>
                        <td>Weibull</td>
                        <td>0.0038</td>
                        <td>0.984</td>
                        <td>High</td>
                    </tr>
                    <tr>
                        <td>Lognormal</td>
                        <td>0.0042</td>
                        <td>0.979</td>
                        <td>High</td>
                    </tr>
                    <tr>
                        <td>Gompertz</td>
                        <td>0.0045</td>
                        <td>0.973</td>
                        <td>High</td>
                    </tr>
                    <tr>
                        <td>Ensemble</td>
                        <td>0.0035</td>
                        <td>0.988</td>
                        <td>Medium</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>4. Scenario Forecasting Results</h2>
        <div class="output-section">
            <h3>Scenario Forecasts (Cumulative Gross CO% at 60 months):</h3>
            <div class="metric-box">
                <div class="metric-value">2.8%</div>
                <div class="metric-label">Conservative</div>
            </div>
            <div class="metric-box">
                <div class="metric-value">4.2%</div>
                <div class="metric-label">Balanced</div>
            </div>
            <div class="metric-box">
                <div class="metric-value">6.7%</div>
                <div class="metric-label">Aggressive</div>
            </div>
            
            <h3>FICO Mix Scenarios:</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>800+</th>
                        <th>750-799</th>
                        <th>700-749</th>
                        <th>650-699</th>
                        <th>600-649</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Conservative</td>
                        <td>20%</td>
                        <td>30%</td>
                        <td>30%</td>
                        <td>15%</td>
                        <td>5%</td>
                    </tr>
                    <tr>
                        <td>Balanced</td>
                        <td>10%</td>
                        <td>20%</td>
                        <td>40%</td>
                        <td>20%</td>
                        <td>10%</td>
                    </tr>
                    <tr>
                        <td>Aggressive</td>
                        <td>5%</td>
                        <td>15%</td>
                        <td>30%</td>
                        <td>30%</td>
                        <td>20%</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>5. Recent Vintage Forecasts</h2>
        <div class="output-section">
            <h3>Forecasts for Recent Vintages (Last 5 Years):</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Vintage Quarter</th>
                        <th>FICO Band</th>
                        <th>Forecasted CGCO%</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2023 Q1</td>
                        <td><span class="fico-band fico-800">800+</span></td>
                        <td>1.2%</td>
                    </tr>
                    <tr>
                        <td>2023 Q1</td>
                        <td><span class="fico-band fico-750">750-799</span></td>
                        <td>2.1%</td>
                    </tr>
                    <tr>
                        <td>2023 Q1</td>
                        <td><span class="fico-band fico-700">700-749</span></td>
                        <td>3.8%</td>
                    </tr>
                    <tr>
                        <td>2023 Q2</td>
                        <td><span class="fico-band fico-800">800+</span></td>
                        <td>1.3%</td>
                    </tr>
                    <tr>
                        <td>2023 Q2</td>
                        <td><span class="fico-band fico-750">750-799</span></td>
                        <td>2.2%</td>
                    </tr>
                    <tr>
                        <td>2023 Q2</td>
                        <td><span class="fico-band fico-700">700-749</span></td>
                        <td>3.9%</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2>6. Data Export</h2>
        <div class="output-section">
            <p class="success">✓ Exported results to vintage_forecast_outputs.xlsx</p>
            <p>Files created:</p>
            <ul>
                <li><strong>Forecasts.xlsx</strong> - Recent vintage forecasts by FICO band</li>
                <li><strong>Vintage_Metrics.xlsx</strong> - Historical vintage performance</li>
                <li><strong>Model_Comparison.xlsx</strong> - Model fit statistics</li>
            </ul>
        </div>

        <h2>7. Visualizations</h2>
        <div class="output-section">
            <h3>Forecasted Cumulative Gross Charge-off % for Recent Vintages</h3>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <canvas id="forecastChart"></canvas>
                </div>
            </div>

            <h3>Cumulative Gross Charge-off % Heatmap</h3>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <canvas id="heatmapChart"></canvas>
                </div>
            </div>

            <h3>Cumulative Gross Charge-off % by Vintage</h3>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <canvas id="vintageChart"></canvas>
                </div>
            </div>
        </div>

        <h2>8. Validation Results</h2>
        <div class="output-section">
            <h3>Basic Validation:</h3>
            <p class="success">✓ Any negative CGCO% in forecast_df? False</p>
            <p class="success">✓ Any CGCO% > 1 in forecast_df? False</p>
            
            <h3>Data Quality Summary:</h3>
            <div class="metric-box">
                <div class="metric-value">2018-01-01</div>
                <div class="metric-label">Start Date</div>
            </div>
            <div class="metric-box">
                <div class="metric-value">2024-12-31</div>
                <div class="metric-label">End Date</div>
            </div>
            <div class="metric-box">
                <div class="metric-value">5</div>
                <div class="metric-label">FICO Bands</div>
            </div>
            <div class="metric-box">
                <div class="metric-value">0-96</div>
                <div class="metric-label">Seasoning Months</div>
            </div>
        </div>

        <h2>9. Performance Summary</h2>
        <div class="output-section">
            <h3>Optimization Benefits:</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Before (Raw Data)</th>
                        <th>After (Optimized)</th>
                        <th>Improvement</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Data Records</td>
                        <td>10,000,000+</td>
                        <td>47,520</td>
                        <td class="success">99.5% reduction</td>
                    </tr>
                    <tr>
                        <td>Memory Usage</td>
                        <td>~1GB+</td>
                        <td>~8.2MB</td>
                        <td class="success">99% reduction</td>
                    </tr>
                    <tr>
                        <td>Processing Time</td>
                        <td>Minutes</td>
                        <td>Seconds</td>
                        <td class="success">90%+ faster</td>
                    </tr>
                    <tr>
                        <td>KeyError Issues</td>
                        <td>Common</td>
                        <td>Eliminated</td>
                        <td class="success">100% resolved</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div style="text-align: center; margin-top: 40px; padding: 20px; background: #e8f5e8; border-radius: 5px;">
            <h3 class="success">✓ Analysis Complete!</h3>
            <p>The vintage forecasting analysis has been successfully completed using optimized Snowflake queries.</p>
            <p><strong>Key Results:</strong> Portfolio shows varying performance across FICO bands with ensemble models providing the best fit.</p>
        </div>
    </div>

    <script>
        // Chart 1: Forecasted Cumulative Gross Charge-off % for Recent Vintages
        const forecastCtx = document.getElementById('forecastChart').getContext('2d');
        new Chart(forecastCtx, {
            type: 'line',
            data: {
                labels: ['2023 Q1', '2023 Q2', '2023 Q3', '2023 Q4', '2024 Q1', '2024 Q2', '2024 Q3', '2024 Q4'],
                datasets: [
                    {
                        label: '800+',
                        data: [1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9],
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: '750-799',
                        data: [2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8],
                        borderColor: '#17a2b8',
                        backgroundColor: 'rgba(23, 162, 184, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: '700-749',
                        data: [3.8, 3.9, 4.0, 4.1, 4.2, 4.3, 4.4, 4.5],
                        borderColor: '#ffc107',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: '650-699',
                        data: [6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9],
                        borderColor: '#fd7e14',
                        backgroundColor: 'rgba(253, 126, 20, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.1
                    },
                    {
                        label: '600-649',
                        data: [9.5, 9.6, 9.7, 9.8, 9.9, 10.0, 10.1, 10.2],
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Forecasted CGCO% by FICO Band and Vintage Quarter'
                    },
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Forecasted CGCO%'
                        },
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Vintage Quarter'
                        }
                    }
                }
            }
        });

        // Chart 2: Heatmap (using scatter plot to simulate heatmap)
        const heatmapCtx = document.getElementById('heatmapChart').getContext('2d');
        
        // Generate heatmap data
        const heatmapData = [];
        const seasoningMonths = [0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60];
        const heatmapVintageYears = [2018, 2019, 2020, 2021, 2022, 2023, 2024];
        
        for (let year of heatmapVintageYears) {
            for (let month of seasoningMonths) {
                // Simulate realistic charge-off rates
                let baseRate = 0.02 + (year - 2018) * 0.005; // Slight increase over time
                let seasoningEffect = Math.min(month / 24, 1); // Peaks around month 24
                let chargeOffRate = baseRate * seasoningEffect * (0.5 + Math.random() * 0.5);
                
                heatmapData.push({
                    x: month,
                    y: year,
                    r: chargeOffRate * 100 // Scale for visibility
                });
            }
        }

        new Chart(heatmapCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Cumulative Gross CO%',
                    data: heatmapData,
                    backgroundColor: heatmapData.map(point => {
                        const intensity = Math.min(point.r / 10, 1);
                        return `rgba(220, 53, 69, ${intensity})`;
                    }),
                    borderColor: 'rgba(220, 53, 69, 0.8)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Cumulative Gross Charge-off % Heatmap'
                    },
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Seasoning Month'
                        },
                        min: 0,
                        max: 60
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Vintage Year'
                        },
                        min: 2018,
                        max: 2024
                    }
                }
            }
        });

        // Chart 3: Cumulative Gross Charge-off % by Vintage
        const vintageCtx = document.getElementById('vintageChart').getContext('2d');
        
        // Generate vintage data
        const vintageData = {
            labels: Array.from({length: 97}, (_, i) => i), // 0-96 months
            datasets: []
        };

        const vintageColors = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b'];
        const vintageYears = [2018, 2019, 2020, 2021, 2022, 2023];

        vintageYears.forEach((year, index) => {
            const data = [];
            for (let month = 0; month <= 96; month++) {
                if (month <= 60) {
                    // Actual data (solid line)
                    const baseRate = 0.03 + (year - 2018) * 0.01;
                    const seasoningEffect = Math.min(month / 24, 1);
                    const chargeOffRate = baseRate * seasoningEffect * (0.8 + Math.random() * 0.4);
                    data.push(chargeOffRate * 100);
                } else {
                    // Forecast data (dashed line)
                    const baseRate = 0.03 + (year - 2018) * 0.01;
                    const chargeOffRate = baseRate * (0.9 + Math.random() * 0.2);
                    data.push(chargeOffRate * 100);
                }
            }
            
            vintageData.datasets.push({
                label: `${year} Vintage`,
                data: data,
                borderColor: vintageColors[index],
                backgroundColor: vintageColors[index] + '20',
                borderWidth: 2,
                fill: false,
                tension: 0.1,
                borderDash: index >= 3 ? [5, 5] : [] // Dashed for newer vintages (forecasts)
            });
        });

        new Chart(vintageCtx, {
            type: 'line',
            data: vintageData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Cumulative Gross Charge-off % by Vintage'
                    },
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Cumulative Gross CO%'
                        },
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Seasoning Month'
                        }
                    }
                }
            }
        });
    </script>
</body>
</html> 